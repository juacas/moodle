function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("tool_gdpr_plus/policies-consent-manager",["exports","./repository","core/notification"],function(a,b,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default=void 0;b=e(b);function d(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;d=function(){return a};return a}function e(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=d();if(b&&b.has(a)){return b.get(a)}var c={},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a){if(Object.prototype.hasOwnProperty.call(a,f)){var g=e?Object.getOwnPropertyDescriptor(a,f):null;if(g&&(g.get||g.set)){Object.defineProperty(c,f,g)}else{c[f]=a[f]}}}c.default=a;if(b){b.set(a,c)}return c}function f(a,b){if(null==a)return{};var c=g(a,b),d,e;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(a);for(e=0;e<f.length;e++){d=f[e];if(0<=b.indexOf(d))continue;if(!Object.prototype.propertyIsEnumerable.call(a,d))continue;c[d]=a[d]}}return c}function g(a,b){if(null==a)return{};var c={},d=Object.keys(a),e,f;for(f=0;f<d.length;f++){e=d[f];if(0<=b.indexOf(e))continue;c[e]=a[e]}return c}function h(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function i(a,b){for(var c=0,d;c<b.length;c++){d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;if("value"in d)d.writable=!0;Object.defineProperty(a,d.key,d)}}function j(a,b,c){if(b)i(a.prototype,b);if(c)i(a,c);return a}function k(a,b,c){if("undefined"!=typeof Reflect&&Reflect.get){k=Reflect.get}else{k=function(a,b,c){var d=l(a,b);if(!d)return;var e=Object.getOwnPropertyDescriptor(d,b);if(e.get){return e.get.call(c)}return e.value}}return k(a,b,c||a)}function l(a,b){while(!Object.prototype.hasOwnProperty.call(a,b)){a=m(a);if(null===a)break}return a}function m(a){m=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)};return m(a)}var n={},o=".policies-settings-container input.policy-checkbox",p=function(){function a(){var b=this,c=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};h(this,a);var d=c.containerId,e=f(c,["containerId"]);this.options=Object.assign(n,e);this.container=document.getElementById(d);this.container.querySelectorAll(".tool_gdpr_plus_action").forEach(function(a){var c=a.dataset.action,d={"accept-selected":b.__acceptSelected,"reject-nonessential":b.__rejectNonEssential,"accept-all":b.__acceptAll};a.addEventListener("click",d[c].bind(b))});if(!this.options.policyAgreed){this.open()}var g=this.container.querySelector(".show-popup");g.addEventListener("click",this.open.bind(this))}j(a,[{key:"open",value:function open(){this.container.querySelector(".policy-container").classList.add("displayed")}},{key:"close",value:function close(){this.container.querySelector(".policy-container").classList.remove("displayed")}},{key:"emit",value:function emit(b){k(m(a.prototype),"emit",this).call(this,b,this)}},{key:"emitConsentChanged",value:function emitConsentChanged(){this.emit("user_cookie_consent_changed",{consent:this._cookie.status,acceptedCategories:this._cookie.acceptedCategories})}},{key:"__getPoliciesAcceptance",value:function __getPoliciesAcceptance(a,b){var c=[];this.container.querySelectorAll(o).forEach(function(d){var e=d.dataset.id,f="1"===d.dataset.mandatory,g=f||d.checked;if(a&&!f){g=!1}g=g||b;var h={policyversionid:e,accepted:g};c.push(h)});return c}},{key:"__acceptSelected",value:function __acceptSelected(){var a=this.__getPoliciesAcceptance(!1,!1);this.__acceptPolicies(a)}},{key:"__rejectNonEssential",value:function __rejectNonEssential(){var a=this.__getPoliciesAcceptance(!0,!1);this.__acceptPolicies(a)}},{key:"__acceptAll",value:function __acceptAll(){var a=this.__getPoliciesAcceptance(!1,!0);this.__acceptPolicies(a)}},{key:"__acceptPolicies",value:function __acceptPolicies(a){this.__setRemotePolicyAcceptance(a);document.dispatchEvent(new Event("grpd_policies_accepted"),a);this.__resetPolicyUI(a);this.close()}},{key:"__setRemotePolicyAcceptance",value:function __setRemotePolicyAcceptance(a){b.acceptPolicies(a).catch(c.exception)}},{key:"__resetPolicyUI",value:function __resetPolicyUI(a){this.container.querySelectorAll(o).forEach(function(b){var c=a&&a.find(function(a){return a.policyid==b.dataset.id});if(c){b.value=b.checked=c.accepted}})}}]);return a}();a.default=p;return a.default});
//# sourceMappingURL=policies-consent-manager.min.js.map
